@using Tiamat.Models
@model Tiamat.WebApp.Models.ViewAccountViewModel

@{
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
    ViewData["Title"] = "Преглед на акаунт";
}

@functions
{
    string GetStatusClass(string status)
    {
        return status?.ToLower() switch
        {
            "active" => "status-active",
            "pending" => "status-pending",
            "failed" or "closed" => "status-red",
            _ => ""
        };
    }
}
<style>
    #particles-js {
        position: fixed !important;
        width: 100% !important;
        height: 100% !important;
        top: 0 !important;
        left: 0 !important;
        z-index: -1 !important;
    }
</style>
<link rel="stylesheet" href="~/css/accountcenter.css" />
<div id="particles-js"></div>


<div class="account-details-container">
    <div class="accounts-card">
        <div class="accounts-card-header">
            <h2>Информация за акаунта</h2>
        </div>
        <div class="accounts-card-body">
            <form method="post" asp-action="ViewAccount" asp-controller="User">
                <input type="hidden" asp-for="AccountId" />
                <input type="hidden" asp-for="Platform" />
                <input type="hidden" asp-for="BrokerLogin" />
                <input type="hidden" asp-for="BrokerPassword" />
                <input type="hidden" asp-for="BrokerServer" />
                <input type="hidden" asp-for="VPSName" />
                <input type="hidden" asp-for="AdminEmail" />

                <div class="table-responsive">
                    <table class="account-table">
                        <thead>
                            <tr>
                                <th>Име на акаунта</th>
                                <th>Първоначален капитал</th>
                                <th>Статус</th>
                                <th>Създаден на</th>
                                <th>Настройка на акаунта</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <input asp-for="AccountName" class="form-control" />
                                </td>
                                <td>
                                    <input class="form-control" value="@Model.InitialCapital" disabled />
                                </td>
                                <td>
                                    <input class="form-control @GetStatusClass(Model.Status.ToString())"
                                           value="@Model.Status" disabled />
                                </td>
                                <td>
                                    <input class="form-control" value="@Model.CreatedAt.ToShortDateString()" disabled />
                                </td>
                                <td>
                                    <select asp-for="AccountSettingsId" class="form-control">
                                        <option value="">Избери</option>
                                        @foreach (var setting in (ViewBag.AccountSettings as List<AccountSetting> ?? new List<AccountSetting>()))
                                        {
                                            <option value="@setting.AccountSettingId"
                                                    selected="@(Model.AccountSettingsId == setting.AccountSettingId ? "selected" : null)">
                                                @setting.SettingName
                                            </option>
                                        }
                                    </select>
                                </td>
                                <td>
                                    <button type="submit" class="btn-save-changes">Запази промените</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </form>
        </div>
    </div>

    <div class="accounts-card">
        <div class="accounts-card-header">
            <h2>Позиции за @Model.AccountName</h2>
        </div>
        <div class="accounts-card-body">
            @if (Model.Positions == null || !Model.Positions.Any())
            {
                <div class="no-positions">Няма намерени позиции за този акаунт.</div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="account-table">
                        <thead>
                            <tr>
                                <th>Символ</th>
                                <th>Тип</th>
                                <th>Размер</th>
                                <th>Риск</th>
                                <th>Дата</th>
                                <th>Резултат</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var pos in Model.Positions)
                            {
                                <tr>
                                    <td>@pos.Symbol</td>
                                    <td>@pos.Type</td>
                                    <td>@pos.Size</td>
                                    <td>@pos.Risk</td>
                                    <td>
                                        @if (pos.ClosedAt.HasValue)
                                        {
                                            @pos.OpenedAt.ToShortDateString() <span class="date-separator"> - </span> @pos.ClosedAt.Value.ToShortDateString()
                                        }
                                        else
                                        {
                                            @pos.OpenedAt.ToShortDateString()
                                        }
                                    </td>
                                    <td>
                                        @if (pos.Result.HasValue)
                                        {
                                            @pos.Result
                                        }
                                        else
                                        {
                                            <span class="open-position">АКТИВЕН</span>
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="~/js/particles-init.js"></script>
    @Html.Partial("_IziToastPartial")
    @await Html.PartialAsync("_ValidationScriptsPartial")
}
