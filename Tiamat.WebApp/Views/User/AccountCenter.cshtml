@model Tiamat.WebApp.Models.AccountCenterViewModel
@{
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
    ViewData["Title"] = "Account List";
}

@functions {
    string GetStatusClass(string status)
    {
        return status?.ToLower() switch
        {
            "active" => "status-active",
            "pending" => "status-pending",
            "failed" or "closed" => "status-red",
            _ => ""
        };
    }
}

<link rel="stylesheet" href="~/css/accountcenter.css" />

<div class="account-list-container">
    <h1 class="list-title">Account List</h1>

    <div class="filter-card">
        <h2 class="filter-title">Filters</h2>
        <form method="post" asp-action="AccountCenter" asp-controller="User" class="filter-form">
            <div class="filter-group">
                <label for="PlatformFilter">Platform</label>
                <select name="PlatformFilter" id="PlatformFilter" class="form-select">
                    <option value="">All</option>
                    <option value="MT4"
                            selected="@(Model.PlatformFilter == "MT4" ? "selected" : null)">
                        MT4
                    </option>
                    <option value="MT5"
                            selected="@(Model.PlatformFilter == "MT5" ? "selected" : null)">
                        MT5
                    </option>
                </select>
            </div>

            <div class="filter-group">
                <label for="StatusFilter">Status</label>
                <select name="StatusFilter" id="StatusFilter" class="form-select">
                    <option value="">All</option>
                    <option value="Pending"
                            selected="@(Model.StatusFilter == "Pending" ? "selected" : null)">
                        Pending
                    </option>
                    <option value="Active"
                            selected="@(Model.StatusFilter == "Active" ? "selected" : null)">
                        Active
                    </option>
                    <option value="Failed"
                            selected="@(Model.StatusFilter == "Failed" ? "selected" : null)">
                        Failed
                    </option>
                    <option value="Closed"
                            selected="@(Model.StatusFilter == "Closed" ? "selected" : null)">
                        Closed
                    </option>
                </select>
            </div>

            <div class="filter-group">
                <label for="AccountSettingFilter">Account Setting</label>
                <select name="AccountSettingFilter" id="AccountSettingFilter" class="form-select">
                    <option value="">All</option>
                    @foreach (var setting in Model.AccountSettings)
                    {
                        <option value="@setting.AccountSettingId"
                                selected="@(Model.AccountSettingFilter?.Equals(
                                        setting.AccountSettingId.ToString(),
                                        StringComparison.OrdinalIgnoreCase) == true
                                            ? "selected"
                                            : null)">
                            @setting.SettingName
                        </option>
                    }
                </select>
            </div>

            <div class="filter-submit">
                <button type="submit" class="apply-btn">Apply</button>
            </div>
        </form>
    </div>

    <div class="accounts-card">
        <div class="accounts-card-header">
            <h2>All Accounts</h2>
            <div class="add-account-button">
                <a asp-action="AddAccount" asp-controller="User" class="btn-add-account">Add Account</a>
            </div>
        </div>

        <div class="accounts-card-body">
            @if (Model.Accounts == null || !Model.Accounts.Any())
            {
                <div class="no-accounts">No accounts found.</div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="account-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Initial Capital</th>
                                <th>Current Capital</th>
                                <th>Platform</th>
                                <th>Account Setting</th>
                                <th>Created At</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var account in Model.Accounts)
                            {
                                <tr>
                                    <td>@account.AccountName</td>
                                    <td>@account.InitialCapital</td>
                                    <td>@account.CurrentCapital</td>
                                    <td>@account.Platform</td>
                                    <td>@(account.AccountSettingName ?? "N/A")</td>
                                    <td>@account.CreatedAt.ToShortDateString()</td>
                                    <td>
                                        <span class="@GetStatusClass(account.Status)">
                                            @account.Status
                                        </span>
                                    </td>
                                    <td class="action-cell">
                                        <a asp-action="ViewAccount"
                                           asp-controller="User"
                                           asp-route-id="@account.AccountId"
                                           class="btn-action btn-edit">
                                            View
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>
