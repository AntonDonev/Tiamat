@model Tiamat.WebApp.Models.AccountCenterViewModel
@{
    Layout = "~/Views/Shared/_LayoutDashboard.cshtml";
    ViewData["Title"] = "Списък на акаунтите";
}

@functions {
    string GetStatusClass(string status)
    {
        return status?.ToLower() switch
        {
            "active" => "status-active",
            "pending" => "status-pending",
            "failed" or "closed" => "status-red",
            _ => ""
        };
    }
}

<style>
    #particles-js {
        position: fixed !important;
        width: 100% !important;
        height: 100% !important;
        top: 0 !important;
        left: 0 !important;
        z-index: -1 !important;
    }
</style>

<link rel="stylesheet" href="~/css/accountcenter.css" />

<div id="particles-js"></div>


<div class="account-list-container">
    <h1 class="list-title">Списък на акаунтите</h1>

    <div class="filter-card">
        <h2 class="filter-title">Филтри</h2>
        <form method="post" asp-action="AccountCenter" asp-controller="User" class="filter-form">
            <div class="filter-group">
                <label for="PlatformFilter">Платформа</label>
                <select name="PlatformFilter" id="PlatformFilter" class="form-select">
                    <option value="">Всички</option>
                    <option value="MT4"
                            selected="@(Model.PlatformFilter == "MT4" ? "selected" : null)">
                        MT4
                    </option>
                    <option value="MT5"
                            selected="@(Model.PlatformFilter == "MT5" ? "selected" : null)">
                        MT5
                    </option>
                </select>
            </div>

            <div class="filter-group">
                <label for="StatusFilter">Статус</label>
                <select name="StatusFilter" id="StatusFilter" class="form-select">
                    <option value="">Всички</option>
                    <option value="Pending"
                            selected="@(Model.StatusFilter == "Pending" ? "selected" : null)">
                        Изчаква
                    </option>
                    <option value="Active"
                            selected="@(Model.StatusFilter == "Active" ? "selected" : null)">
                        Активен
                    </option>
                    <option value="Failed"
                            selected="@(Model.StatusFilter == "Failed" ? "selected" : null)">
                        Неуспешен
                    </option>
                    <option value="Closed"
                            selected="@(Model.StatusFilter == "Closed" ? "selected" : null)">
                        Затворен
                    </option>
                </select>
            </div>

            <div class="filter-group">
                <label for="AccountSettingFilter">Настройка на акаунта</label>
                <select name="AccountSettingFilter" id="AccountSettingFilter" class="form-select">
                    <option value="">Всички</option>
                    @foreach (var setting in Model.AccountSettings)
                    {
                        <option value="@setting.AccountSettingId"
                                selected="@(Model.AccountSettingFilter?.Equals(
                                        setting.AccountSettingId.ToString(),
                                        StringComparison.OrdinalIgnoreCase) == true
                                            ? "selected"
                                            : null)">
                            @setting.SettingName
                        </option>
                    }
                </select>
            </div>

            <div class="filter-submit">
                <button type="submit" class="apply-btn">Приложи</button>
            </div>
        </form>
    </div>

    <div class="accounts-card">
        <div class="accounts-card-header">
            <h2>Всички акаунти</h2>
            <div class="add-account-button">
                <a asp-action="AddAccount" asp-controller="User" class="btn-add-account">Добави акаунт</a>
            </div>
        </div>

        <div class="accounts-card-body">
            @if (Model.Accounts == null || !Model.Accounts.Any())
            {
                <div class="no-accounts">Няма намерени акаунти.</div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="account-table">
                        <thead>
                            <tr>
                                <th>Име</th>
                                <th>Първоначален капитал</th>
                                <th>Текущ капитал</th>
                                <th>Платформа</th>
                                <th>Настройка на акаунта</th>
                                <th>Създаден на</th>
                                <th>Статус</th>
                                <th>Действия</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var account in Model.Accounts)
                            {
                                <tr>
                                    <td>@account.AccountName</td>
                                    <td>@account.InitialCapital</td>
                                    <td>@account.CurrentCapital</td>
                                    <td>@account.Platform</td>
                                    <td>@(account.AccountSettingName ?? "Няма")</td>
                                    <td>@account.CreatedAt.ToShortDateString()</td>
                                    <td>
                                        <span class="@GetStatusClass(account.Status)">
                                            @account.Status
                                        </span>
                                    </td>
                                    <td class="action-cell">
                                        <a asp-action="ViewAccount"
                                           asp-controller="User"
                                           asp-route-id="@account.AccountId"
                                           class="btn-action btn-edit">
                                            Преглед
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {

    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="~/js/particles-init.js"></script>

    @Html.Partial("_IziToastPartial")
    @await Html.PartialAsync("_ValidationScriptsPartial")
}